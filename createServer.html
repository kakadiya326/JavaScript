<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Server Practice</title>
    <style>
        body {
            position: relative;
        }

        * {
            font-size: 12px;
        }

        form {
            width: 40%;
            margin: 15px auto;
            padding: 20px;
            border-radius: 20px;
            border: 2px solid black;
            display: flex;
            flex-direction: column;
            gap: 7px;
            background-color: #f2f2f2;
        }

        label {
            font-weight: bold;
        }

        input {
            padding: 7px;
            border: 1.5 solid #333;
            border-radius: 6px;
        }

        input:hover {
            border-color: blue;
        }

        input:focus {
            border-color: blue;
            box-shadow: 0px 0px 4px blue;
            outline: none;
        }

        /* Buttons */
        .btncon {
            align-self: center;
            width: 100%;
            display: flex;
            padding: 20px;
            justify-content: space-evenly;
        }

        .btncon button {
            width: 32%;
            padding: 10px 30px;
            border: 2px solid black;
            background-color: azure;
            border-radius: 7px;
            font-weight: bolder;
            font-size: 14px;
            box-sizing: border-box;
        }

        .btncon button:hover {
            color: black;
            border: 2px solid black;
            background-color: lightgrey;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-family: Arial, sans-serif;
        }

        thead {
            background-color: #d9d9d9;
        }

        th,
        td {
            max-width: 300px;
            border: 1px solid #000;
            padding: 10px 12px;
            text-align: center;
            line-break: loose;

        }

        tbody tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tbody tr:hover {
            background-color: #e5e5e5;
            cursor: pointer;
        }

        .tdBtns button {
            font-weight: bolder;
            font-size: 14px;
            border-radius: 9px;
        }

        .tdBtns button:nth-child(1) {
            background-color: lightgreen;
        }

        .tdBtns button:nth-child(2) {
            background-color: lightcoral;
        }

        /* hover */
        .tdBtns button:nth-child(1):hover {
            background-color: darkgreen;
            color: white;
            border: 2px solid black;
        }

        .tdBtns button:nth-child(2):hover {
            background-color: darkred;
            color: white;
            border: 2px solid black;
        }

        /* Search */
        .search {
            width: 500px;
            position: relative;
            top: 50%;
            left: 50%;
            transform: translate(-50%);
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #cecbcb;
            border-radius: 20px 0px 0px 20px;
            padding: 9px 3px;
            padding-left: 20px;
        }

        .search>label {
            font-size: 16px;

        }

        input[type="search"] {
            width: 90%;
            border: none;
            border-radius: 13px 0px 0px 13px;
        }
    </style>
</head>

<body>

    <form action="">
        <input type="hidden" name="id" id="id">

        <label for="name">Name : </label>
        <input type="text" name="name" id="name" placeholder="Enter your full name..!!">

        <label for="department">Department : </label>
        <input type="text" name="department" id="department" placeholder="Enter your department..!">

        <label for="course">Course : </label>
        <input list="course" name="course" id="courseInput" placeholder="Select Course">
        <datalist id="course">
            <option value="MCA">MCA</option>
            <option value="B.tech">BTech</option>
        </datalist>

        <label for="year">Year : </label>
        <input type="text" name="year" id="year" placeholder="Which year are in..??">

        <label for="age">Age : </label>
        <input type="number" name="age" id="age" min="17" step="1" placeholder="How old are you..??">

        <label for="email">Email : </label>
        <input type="email" name="email" id="email" placeholder="abc@gmail.com">

        <label for="phone">Phone : </label>
        <input type="tel" name="phone" id="phone" placeholder="Ex. +91 1234567890">

        <label for="address">Address : </label>
        <input type="text" name="address" id="address" placeholder="Enter your full address..!!">

        <label for="cgpa">CGPA : </label>
        <input type="number" name="cgpa" id="cgpa" min="0" max="9" step="0.01" placeholder="Enter your CGPA..!!">

        <div class="btncon">
            <button id="addBtn" onclick="updateTable(event,'POST')">Add</button>
            <button id="updateBtn" onclick="updateTable(event,'PUT')">Update</button>
            <button onclick="clearData(event)">Clear</button>
        </div>
    </form>

    <div class="search">
        <label for="search">Search</label>
        <input type="search" name="search" id="search" placeholder="Enter text to search.....">
    </div>

    <table>
        <thead></thead>
        <tbody></tbody>
    </table>

    <script>
        var tableHeadArr = ['', 'Name', 'Department', 'Course', 'Year', 'Age', 'Email', 'Phone', 'Address', 'CGPA'];
        let form = document.querySelectorAll('form input');
        let tHead = document.querySelector('thead');
        let tBody = document.querySelector('tbody');
        let addBtn = document.getElementById('addBtn');
        let updateBtn = document.getElementById('updateBtn');
        var idField = document.getElementById('id');
        let searchInp = document.getElementById('search');
        updateBtn.disabled = true;
        addBtn.disabled = false;

        var flag = true;

        function changeBtn() {
            if (flag) {
                updateBtn.disabled = true;
                addBtn.disabled = false;
            } else {
                updateBtn.disabled = false;
                addBtn.disabled = true;
            }
        }

        function clearData(e) {
            e.preventDefault();
            form.forEach(ele => {
                ele.value = '';
            })
        }

        searchInp.addEventListener('change', (e) => {
            console.log(e.target.value);
            console.log('click');
        })


        async function getData() {
            let data = await fetch('http://localhost:3000/students');
            return data = await data.json();
        }

        function tableHead() {
            let tr = document.createElement('tr');
            tableHeadArr.forEach((val) => {
                let th = document.createElement('th');
                th.innerText = val;

                tr.append(th);
            })
            tHead.append(tr);
        }

        async function tableBody() {
            tBody.innerHTML = "";
            let data = await getData();
            data.forEach(obj => {
                let tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <div class="tdBtns"> 
                            <button onclick="updateData(${obj.id})">Update</button> 
                            <button onclick="deleteData(${obj.id})">Delete</button>
                        </div>
                    </td>
                    <td>${obj.name}</td>
                    <td>${obj.department}</td>
                    <td>${obj.course}</td>
                    <td>${obj.year}</td>
                    <td>${obj.age}</td>
                    <td>${obj.email}</td>
                    <td>${obj.phone}</td>
                    <td>${obj.address}</td>
                    <td>${obj.cgpa}</td>
                
                `;
                tBody.append(tr);
            });
        }

        async function deleteData(id) {
            let data = await fetch(`http://localhost:3000/students/${id}`, {
                method: 'DELETE',
            });
            tableBody();
        }

        async function updateData(id) {
            let data = await fetch(`http://localhost:3000/students/?id=${id}`);
            data = await data.json();
            setFormData(data[0]);
            idField.value = id;
            flag = false;
            changeBtn();
        }

        function setFormData(data) {
            for (let key in data) {
                let input = document.getElementById(key);
                if (input) {
                    input.value = data[key];
                }
                let courseInput = document.getElementById("courseInput");
                if (courseInput && data.course) {
                    courseInput.value = data.course;
                }
            }
        }

        function getFormData() {
            let data = {};
            form.forEach((val) => {
                data[val.name] = val.value;
            })
            return data;
        }

        tableHead();
        tableBody();

        async function updateTable(e, methodName) {
            let emptyFields = []
            e.preventDefault();
            let containerArr = {};
            form.forEach(val => {
                if (val.value !== '') {
                    containerArr[val.name] = val.value;
                } else {
                    emptyFields.push(val.name)
                }
            });

            if (emptyFields.length > 1) {
                alert(`These fields are empty: ${emptyFields.join(", ")}`)
            } else {
                var url;
                if (methodName == 'POST') {
                    url = `http://localhost:3000/students`;
                    flag = true;
                    changeBtn();
                } else {
                    url = `http://localhost:3000/students/${containerArr.id}`;
                    flag = true;
                    changeBtn();
                }
                let data = await fetch(url, {
                    method: `${methodName}`,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(containerArr)
                })
            }
        }

    </script>
</body>

</html>